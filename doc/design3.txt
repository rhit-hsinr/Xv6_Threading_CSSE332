---
Title: Project Milestone 3
Author(s): Richard Hsin, Reilly Mooney, Ben Werdmann
Date: 2/21/2025
---

High level description
======================

We have added two kernel system calls and two user functions. The two kernel system calls are called clone and join while the two user functions are called 
uspork_create and uspork_join.

uspork_create(void(*func)(void*), void *arg, void *stack)
uspork_join(int pid, void **stack)

1. The clone function is used for process creation and essentially imitating a lightweight thread being implemented.
2. The join function is to safely join the thread in the future to avoid memory leaks etc.

The user function allows the user to do a system call through the user function by creating a wrapper around the system calls.

Memory is shared between threads.

The user is responsible for stack creation and managment. 

Thread creation
================

1. The thread is being created in the kernel space where the clone function will take in 3 arguments. The first one being the thread function, second the argument, 
   and third is a pre-malloced stack. The stack will be generated in the userspace function to lessen the burden of the user to malloc each time they want to create 
   thread. The userspace function will have an extra integer argument that can specify the size of the stack.
2. The register that is responsible for influencing where the thread starts will be the epc. 
3. The threads are currently being exited through bruteforce by using exit(0). This will be changed later on to prevent all threads from collapsing due to the exiting 
   of one single thread. A new system call will be created so that the user can exit a thread when need by call.

Memory sharing
===============

1. Each thread has its own stack, but the rest of the memory is shared.
2. Clone shares memory between threads, ensuring that the parent and child threads operate on the same memory space. 
3. Clone calls copypasta, which copies the memory pages of a parent process to a child process. It shares the physical pages by incrmementing reference counts.
4. We were unable to fully implement dynamic memory in our project. 


Test cases
===========

- Describe the test case you used for the creation of the threads.

- Describe the test case you used for testing shared memory between threads.


1. I created a random thread function that takes an argument and prints it out. We used the userspace function to create two threads and then sleep for 2 seconds 
   to allow the thread to run. By putting print statements before and after the clone, we can see that the two threads are running the moment they are created.

2. 


Additional comments
==================

N/A

Grade
======

The grade you believe should be assigned to your group, with some argument as
to why you chose that grade.

We believe that we deserve a 90. 
